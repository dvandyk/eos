/* vim: set sw=4 sts=4 tw=120 et foldmethod=syntax : */

/*
 * Copyright (c) 2019 Danny van Dyk
 *
 * This file is part of the EOS project. EOS is free software;
 * you can redistribute it and/or modify it under the terms of the GNU General
 * Public License version 2, as published by the Free Software Foundation.
 *
 * EOS is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA  02111-1307  USA
 */

#include <eos/form-factors/unitarity-bounds.hh>
#include <eos/utils/kinematic.hh>
#include <eos/utils/model.hh>
#include <eos/utils/options.hh>
#include <eos/utils/options-impl.hh>
#include <eos/utils/private_implementation_pattern-impl.hh>

#include <cmath>

#include <iostream>

namespace eos
{
    template <> struct Implementation<HQETUnitarityBounds>
    {
        // option to determine if we use z^3 terms in the leading-power IW function
        SwitchOption opt_lp_zorder;
        std::function<double ()> bound_0p;
        std::function<double ()> bound_0m;

        // parameters for the leading Isgur-Wise function xi
        UsedParameter xipone, xippone, xipppone, xippppone, xipppppone;

        // parameters for the subleading Isgur-Wise function chi2
        UsedParameter chi2one, chi2pone, chi2ppone, chi2pppone;

        // parameters for the subleading Isgur-Wise function chi3
        UsedParameter chi3pone, chi3ppone, chi3pppone;

        // parameters for the subleading Isgur-Wise function eta
        UsedParameter etaone, etapone, etappone, etapppone;

        // parameters for subsubleading 1/mc corrections in h+ (B->D), equal to delta{h+}
        UsedParameter l1one, l1pone, l1ppone;

        // parameters for subsubleading 1/mc corrections in hA1 (B->D^*), equal to delta{A1}
        UsedParameter l2one, l2pone, l2ppone;

        // parameters for subsubleading 1/m_c corrections
        UsedParameter l3one, l3pone, l3ppone;
        UsedParameter l4one, l4pone, l4ppone;
        UsedParameter l5one, l5pone, l5ppone;
        UsedParameter l6one, l6pone, l6ppone;

        Implementation(const Parameters & p, const Options & o, ParameterUser & u) :
            opt_lp_zorder(o, "z-order-lp", { "3", "4" }, "3"),
            xipone(p["B(*)->D(*)::xi'(1)@HQET"], u),
            xippone(p["B(*)->D(*)::xi''(1)@HQET"], u),
            xipppone(p["B(*)->D(*)::xi'''(1)@HQET"], u),
            xippppone(p["B(*)->D(*)::xi''''(1)@HQET"], u),
            xipppppone(p["B(*)->D(*)::xi'''''(1)@HQET"], u),
            chi2one(p["B(*)->D(*)::chi_2(1)@HQET"], u),
            chi2pone(p["B(*)->D(*)::chi_2'(1)@HQET"], u),
            chi2ppone(p["B(*)->D(*)::chi_2''(1)@HQET"], u),
            chi2pppone(p["B(*)->D(*)::chi_2'''(1)@HQET"], u),
            chi3pone(p["B(*)->D(*)::chi_3'(1)@HQET"], u),
            chi3ppone(p["B(*)->D(*)::chi_3''(1)@HQET"], u),
            chi3pppone(p["B(*)->D(*)::chi_3'''(1)@HQET"], u),
            etaone(p["B(*)->D(*)::eta(1)@HQET"], u),
            etapone(p["B(*)->D(*)::eta'(1)@HQET"], u),
            etappone(p["B(*)->D(*)::eta''(1)@HQET"], u),
            etapppone(p["B(*)->D(*)::eta'''(1)@HQET"], u),
            l1one(p["B(*)->D(*)::l_1(1)@HQET"], u),
            l1pone(p["B(*)->D(*)::l_1'(1)@HQET"], u),
            l1ppone(p["B(*)->D(*)::l_1''(1)@HQET"], u),
            l2one(p["B(*)->D(*)::l_2(1)@HQET"], u),
            l2pone(p["B(*)->D(*)::l_2'(1)@HQET"], u),
            l2ppone(p["B(*)->D(*)::l_2''(1)@HQET"], u),
            l3one(p["B(*)->D(*)::l_3(1)@HQET"], u),
            l3pone(p["B(*)->D(*)::l_3'(1)@HQET"], u),
            l3ppone(p["B(*)->D(*)::l_3''(1)@HQET"], u),
            l4one(p["B(*)->D(*)::l_4(1)@HQET"], u),
            l4pone(p["B(*)->D(*)::l_4'(1)@HQET"], u),
            l4ppone(p["B(*)->D(*)::l_4''(1)@HQET"], u),
            l5one(p["B(*)->D(*)::l_5(1)@HQET"], u),
            l5pone(p["B(*)->D(*)::l_5'(1)@HQET"], u),
            l5ppone(p["B(*)->D(*)::l_5''(1)@HQET"], u),
            l6one(p["B(*)->D(*)::l_6(1)@HQET"], u),
            l6pone(p["B(*)->D(*)::l_6'(1)@HQET"], u),
            l6ppone(p["B(*)->D(*)::l_6''(1)@HQET"], u)
        {
            if ("3" == opt_lp_zorder.value())
            {
                bound_0p = std::bind(&Implementation::bound_0p_z3, this);
                bound_0m = std::bind(&Implementation::bound_0m_z3, this);
            }
            else
            {
                throw InternalError("Only z-order-lp=3 is presently supported");
            }
        }

        ~Implementation() = default;

        double bound_0p_z3() const
        {
            const std::array<double, 3> weak_bounds
            {
                    0.008816389627780122 + 0.17862041985779245*(0.0772459760513371*(3.9810795585543546 - 15.206229334195553*chi2one + 45.61868800258667*chi3pone - 7.962159117108709*etaone)*(2.7037024528945066 + 3.8222474761508347*xipone) + 30.47847347626978*(0.7200006535515976 - 5.812256763540315*chi2one - 6.1242491401754915*chi2pone + 17.436770290620945*chi3pone + 9.186373710263238*chi3ppone - 1.4400013071031952*etaone - 3.206728312142288*etapone + 1.603364156071144*xipone - 6.1242491401754915*chi2one*xipone + 18.372747420526476*chi3pone*xipone - 3.206728312142288*etaone*xipone)*(0.28772922103887344 + 1.4737543334870251*xipone + 0.7696975793569752*xippone) + 285.0233583515618*(0.2439784287275445 - 6.531819613559962*chi2one - 19.210504214158036*chi2pone - 8.010676993435156*chi2ppone + 17.34245593627625*chi3pone + 16.799740831084318*chi3ppone - 0.487956857455089*etaone - 5.8643602207804335*etapone - 4.1944839483684495*etappone + 2.9321801103902168*xipone - 19.210504214158036*chi2one*xipone - 16.021353986870313*chi2pone*xipone + 57.6315126424741*chi3pone*xipone + 24.032030980305468*chi3ppone*xipone - 5.8643602207804335*etaone*xipone - 8.388967896736899*etapone*xipone + 2.0972419741842248*xippone - 8.010676993435156*chi2one*xippone + 24.032030980305468*chi3pone*xippone - 4.1944839483684495*etaone*xippone)*(0.09888731493086485 + 1.653645045991937*xipone + 2.431101174672666*xippone + 0.6711896212070136*xipppone)) + 0.0006034841879010711*pow(0.020690142601946397,2) + 0.03862298802566855*pow(2.7037024528945066 + 3.8222474761508347*xipone,2) + 15.23923673813489*pow(0.28772922103887344 + 1.4737543334870251*xipone + 0.7696975793569752*xippone,2) + pow(0.17862041985779245,2)*(0.017537845443601936*l1one + 0.03862298802566855*(2*(2.7037024528945066 + 3.8222474761508347*xipone)*(-6.530221765184699 - 24.942995562895145*chi2one + 74.82898668868546*chi3pone + 13.060443530369398*etaone + 2.657502314742668*l1one + 3.8015573335488884*l1pone - 3.9810795585543546*l4one + 3.8015573335488884*l1one*xipone) + pow(3.9810795585543546 - 15.206229334195553*chi2one + 45.61868800258667*chi3pone - 7.962159117108709*etaone,2)) + 15.23923673813489*(2*(0.28772922103887344 + 1.4737543334870251*xipone + 0.7696975793569752*xippone)*(-1.1810273745137605 - 9.533927936847265*chi2one - 10.045693496542476*chi2pone + 28.601783810541797*chi3pone + 15.068540244813715*chi3ppone + 2.362054749027521*etaone + 5.260042335498996*etapone + 0.28486263672004786*l1one + 1.0702986196241107*l1pone - 0.7200006535515976*l4one - 1.603364156071144*l4pone - 2.630021167749498*xipone - 10.045693496542476*chi2one*xipone + 30.13708048962743*chi3pone*xipone + 5.260042335498996*etaone*xipone + 1.4530641908850788*l1one*xipone + 1.5310622850438729*l1pone*xipone - 1.603364156071144*l4one*xipone + 0.7655311425219364*l1one*xippone) + pow(0.7200006535515976 - 5.812256763540315*chi2one - 6.1242491401754915*chi2pone + 17.436770290620945*chi3pone + 9.186373710263238*chi3ppone - 1.4400013071031952*etaone - 3.206728312142288*etapone + 1.603364156071144*xipone - 6.1242491401754915*chi2one*xipone + 18.372747420526476*chi3pone*xipone - 3.206728312142288*etaone*xipone,2)) + 142.5116791757809*(2*(0.09888731493086485 + 1.653645045991937*xipone + 2.431101174672666*xippone + 0.6711896212070136*xipppone)*(-0.4002013077303896 - 10.714237175963035*chi2one - 31.511264945687568*chi2pone - 13.140028097150212*chi2ppone + 28.447078625565606*chi3pone + 27.556855272806036*chi3ppone + 0.8004026154607792*etaone + 9.619393983306871*etapone + 6.880272039401276*etappone + 0.10441935258933986*l1one + 0.745215460061174*l1pone - 0.2439784287275445*l4one - 1.8835591232981042*l4pone - 4.809696991653436*xipone - 31.511264945687568*chi2one*xipone - 26.280056194300425*chi2pone*xipone + 94.5337948370627*chi3pone*xipone + 39.420084291450635*chi3ppone*xipone + 9.619393983306871*etaone*xipone + 13.760544078802551*etapone*xipone + 1.6329549033899906*l1one*xipone + 3.8012914293601137*l1pone*xipone - 2.9321801103902168*l4one*xipone - 4.1944839483684495*l4pone*xipone - 3.440136019700638*xippone - 13.140028097150212*chi2one*xippone + 39.420084291450635*chi3pone*xippone + 6.880272039401276*etaone*xippone + 2.4013130267697544*l1one*xippone + 2.002669248358789*l1pone*xippone - 2.0972419741842248*l4one*xippone + 0.6675564161195963*l1one*xipppone) + pow(0.2439784287275445 - 6.531819613559962*chi2one - 19.210504214158036*chi2pone - 8.010676993435156*chi2ppone + 17.34245593627625*chi3pone + 16.799740831084318*chi3ppone - 0.487956857455089*etaone - 5.8643602207804335*etapone - 4.1944839483684495*etappone + 2.9321801103902168*xipone - 19.210504214158036*chi2one*xipone - 16.021353986870313*chi2pone*xipone + 57.6315126424741*chi3pone*xipone + 24.032030980305468*chi3ppone*xipone - 5.8643602207804335*etaone*xipone - 8.388967896736899*etapone*xipone + 2.0972419741842248*xippone - 8.010676993435156*chi2one*xippone + 24.032030980305468*chi3pone*xippone - 4.1944839483684495*etaone*xippone,2))) + 142.5116791757809*pow(0.09888731493086485 + 1.653645045991937*xipone + 2.431101174672666*xippone + 0.6711896212070136*xipppone,2),
                    0.01634408678495028 + 0.17862041985779245*(0.14320090078518152*(4.205795330555218 - 15.206229334195555*chi3pone)*(2.6905522753372573 + 3.822247476150835*xipone) + 59.105179536795575*(0.7374633594130332 - 5.660259621969909*chi3pone - 2.9939299298589823*chi3ppone + 1.656144497399369*xipone - 5.987859859717965*chi3pone*xipone)*(0.27744393577304327 + 1.4357550480944237*xipone + 0.75255613121932*xippone) + 557.7516400547881*(0.24348400780674417 - 5.570489670037709*chi3pone - 5.421125768789015*chi3ppone + 2.9987901594319317*xipone - 18.6391873923393*chi3pone*xipone - 7.796935854761266*chi3ppone*xipone + 2.1565054485171147*xippone - 7.796935854761266*chi3pone*xippone)*(0.09338034155735989 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569984*xipppone)) + 0.0011187570373842302*pow(0.020690142601946397,2) + 0.07160045039259076*pow(2.6905522753372573 + 3.822247476150835*xipone,2) + 29.552589768397787*pow(0.27744393577304327 + 1.4357550480944237*xipone + 0.75255613121932*xippone,2) + pow(0.17862041985779245,2)*(0.032512182429878383*l2one + 0.07160045039259076*(2*(2.6905522753372573 + 3.822247476150835*xipone)*(-6.8988262614568585 - 24.94299556289515*chi3pone + 2.6431819892228363*l2one + 3.801557333548889*l2pone - 4.205795330555218*l5one + 3.801557333548889*l2one*xipone) + pow(4.205795330555218 - 15.206229334195555*chi3pone,2)) + 29.552589768397787*(2*(0.27744393577304327 + 1.4357550480944237*xipone + 0.75255613121932*xippone)*(-1.2096717008122218 - 9.284604850601443*chi3pone - 4.910986104106538*chi3ppone + 0.2745444030911792*l2one + 1.0408236642601045*l2pone - 0.7374633594130332*l5one - 1.656144497399369*l5pone - 2.7165975168643626*xipone - 9.821972208213076*chi3pone*xipone + 1.4150649054924773*l2one*xipone + 1.4969649649294912*l2pone*xipone - 1.656144497399369*l5one*xipone + 0.7484824824647456*l2one*xippone) + pow(0.7374633594130332 - 5.660259621969909*chi3pone - 2.9939299298589823*chi3ppone + 1.656144497399369*xipone - 5.987859859717965*chi3pone*xipone,2)) + 278.87582002739407*(2*(0.09338034155735989 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569984*xipppone)*(-0.3993903020193293 - 9.137353913928349*chi3pone - 8.892350169461281*chi3ppone + 0.0988417557483804*l2one + 0.7149816964108006*l2pone - 0.24348400780674417*l5one - 1.9205374351733748*l5pone - 4.918958408220097*xipone - 30.574125787882938*chi3pone*xipone - 12.78942544896037*chi3ppone*xipone + 1.5753631016053946*l2one*xipone + 3.6851798662396655*l2pone*xipone - 2.9987901594319317*l5one*xipone - 4.313010897034229*l5pone*xipone - 3.537346744650238*xippone - 12.78942544896037*chi3pone*xippone + 2.3298984240424123*l2one*xippone + 1.9492339636903164*l2pone*xippone - 2.1565054485171147*l5one*xippone + 0.6497446545634388*l2one*xipppone) + pow(0.24348400780674417 - 5.570489670037709*chi3pone - 5.421125768789015*chi3ppone + 2.9987901594319317*xipone - 18.6391873923393*chi3pone*xipone - 7.796935854761266*chi3ppone*xipone + 2.1565054485171147*xippone - 7.796935854761266*chi3pone*xippone,2))) + 278.87582002739407*pow(0.09338034155735989 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569984*xipppone,2),
                    0.00817204339247514 + 0.17862041985779245*(0.07160045039259073*(4.205795330555218 + 15.206229334195555*chi2one - 15.206229334195555*chi3pone + 8.411590661110436*etaone)*(2.6905522753372573 + 3.822247476150835*xipone) + 29.552589768397777*(0.7374633594130334 + 5.660259621969909*chi2one + 5.9878598597179655*chi2pone - 5.660259621969909*chi3pone - 2.9939299298589828*chi3ppone + 1.4749267188260669*etaone + 3.3122889947987386*etapone + 1.6561444973993693*xipone + 5.9878598597179655*chi2one*xipone - 5.9878598597179655*chi3pone*xipone + 3.3122889947987386*etaone*xipone)*(0.27744393577304327 + 1.4357550480944237*xipone + 0.7525561312193201*xippone) + 278.875820027394*(0.24348400780674434 + 6.3014524064215784*chi2one + 18.639187392339295*chi2pone + 7.796935854761264*chi2ppone - 5.57048967003771*chi3pone - 5.421125768789017*chi3ppone + 0.48696801561348835*etaone + 5.997580318863864*etapone + 4.313010897034229*etappone + 2.9987901594319326*xipone + 18.639187392339295*chi2one*xipone + 15.593871709522528*chi2pone*xipone - 18.6391873923393*chi3pone*xipone - 7.796935854761266*chi3ppone*xipone + 5.997580318863864*etaone*xipone + 8.626021794068459*etapone*xipone + 2.156505448517115*xippone + 7.796935854761264*chi2one*xippone - 7.796935854761266*chi3pone*xippone + 4.313010897034229*etaone*xippone)*(0.09338034155735994 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569985*xipppone)) + 0.0005593785186921151*pow(0.020690142601946397,2) + 0.03580022519629537*pow(2.6905522753372573 + 3.822247476150835*xipone,2) + 14.776294884198888*pow(0.27744393577304327 + 1.4357550480944237*xipone + 0.7525561312193201*xippone,2) + pow(0.17862041985779245,2)*(0.016256091214939192*l2one + 0.03580022519629537*(2*(2.6905522753372573 + 3.822247476150835*xipone)*(-6.8988262614568585 + 24.94299556289515*chi2one - 24.94299556289515*chi3pone - 13.797652522913717*etaone + 2.6431819892228363*l2one + 3.801557333548889*l2pone + 3.801557333548889*l3one + 4.205795330555218*l5one - 8.411590661110436*l6one + 3.801557333548889*l2one*xipone) + pow(4.205795330555218 + 15.206229334195555*chi2one - 15.206229334195555*chi3pone + 8.411590661110436*etaone,2)) + 14.776294884198888*(2*(0.27744393577304327 + 1.4357550480944237*xipone + 0.7525561312193201*xippone)*(-1.2096717008122222 + 9.284604850601443*chi2one + 9.821972208213076*chi2pone - 9.284604850601443*chi3pone - 4.910986104106538*chi3ppone - 2.4193434016244444*etaone - 5.433195033728726*etapone + 0.2745444030911792*l2one + 1.0408236642601045*l2pone + 1.4150649054924773*l3one + 1.4969649649294914*l3pone + 0.7374633594130333*l5one + 1.6561444973993693*l5pone - 3.131071216225436*l6one - 3.3122889947987386*l6pone - 2.716597516864363*xipone + 9.821972208213076*chi2one*xipone - 9.821972208213076*chi3pone*xipone - 5.433195033728726*etaone*xipone + 1.4150649054924773*l2one*xipone + 1.4969649649294914*l2pone*xipone + 1.4969649649294914*l3one*xipone + 1.6561444973993693*l5one*xipone - 3.3122889947987386*l6one*xipone + 0.7484824824647457*l2one*xippone) + pow(0.7374633594130334 + 5.660259621969909*chi2one + 5.9878598597179655*chi2pone - 5.660259621969909*chi3pone - 2.9939299298589828*chi3ppone + 1.4749267188260669*etaone + 3.3122889947987386*etapone + 1.6561444973993693*xipone + 5.9878598597179655*chi2one*xipone - 5.9878598597179655*chi3pone*xipone + 3.3122889947987386*etaone*xipone,2)) + 139.437910013697*(2*(0.09338034155735994 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569985*xipppone)*(-0.39939030201932957 + 10.336362549768385*chi2one + 30.574125787882924*chi2pone + 12.789425448960367*chi2ppone - 9.13735391392835*chi3pone - 8.892350169461285*chi3ppone - 0.7987806040386586*etaone - 9.837916816440195*etapone - 7.074693489300476*etappone + 0.09884175574838046*l2one + 0.7149816964108007*l2pone + 1.5753631016053946*l3one + 3.6851798662396655*l3pone + 0.243484007806744*l5one + 1.9205374351733744*l5pone - 3.48575817504542*l6one - 8.154085767380979*l6pone - 4.918958408220098*xipone + 30.574125787882924*chi2one*xipone + 25.578850897920734*chi2pone*xipone - 30.574125787882938*chi3pone*xipone - 12.78942544896037*chi3ppone*xipone - 9.837916816440195*etaone*xipone - 14.149386978600951*etapone*xipone + 1.5753631016053946*l2one*xipone + 3.685179866239667*l2pone*xipone + 4.659796848084824*l3one*xipone + 3.898467927380632*l3pone*xipone + 2.9987901594319317*l5one*xipone + 4.313010897034228*l5pone*xipone - 10.310591215898095*l6one*xipone - 8.626021794068459*l6pone*xipone - 3.5373467446502387*xippone + 12.789425448960367*chi2one*xippone - 12.78942544896037*chi3pone*xippone - 7.074693489300476*etaone*xippone + 2.3298984240424123*l2one*xippone + 1.9492339636903164*l2pone*xippone + 1.949233963690316*l3one*xippone + 2.156505448517114*l5one*xippone - 4.313010897034229*l6one*xippone + 0.6497446545634389*l2one*xipppone) + pow(0.24348400780674434 + 6.3014524064215784*chi2one + 18.639187392339295*chi2pone + 7.796935854761264*chi2ppone - 5.57048967003771*chi3pone - 5.421125768789017*chi3ppone + 0.48696801561348835*etaone + 5.997580318863864*etapone + 4.313010897034229*etappone + 2.9987901594319326*xipone + 18.639187392339295*chi2one*xipone + 15.593871709522528*chi2pone*xipone - 18.6391873923393*chi3pone*xipone - 7.796935854761266*chi3ppone*xipone + 5.997580318863864*etaone*xipone + 8.626021794068459*etapone*xipone + 2.156505448517115*xippone + 7.796935854761264*chi2one*xippone - 7.796935854761266*chi3pone*xippone + 4.313010897034229*etaone*xippone,2))) + 139.437910013697*pow(0.09338034155735994 + 1.596053244207341*xipone + 2.3594917525206625*xippone + 0.6532809183569985*xipppone,2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            static_assert(std::numeric_limits<double>::is_iec559, "Unexpected absence of IEC559");
            return (0.0 < result) && (result < 1.0) ? std::log(1.0) : std::log(1.0e-100);
        }

        double bound_0m_z3() const
        {
            const std::array<double, 3> weak_bounds
            {
                    0.005812539822323326 + 0.0006704953120457946*pow(-21.43471968802391 - 23.554564814934146*xipone,2) + 0.5320248102904437*pow(-1.881506838321464 - 7.759898406814436*xipone - 3.3447757526006585*xippone,2) + 137.1638547267834*pow(-0.12317478944736678 - 1.8519260853437824*xipone - 2.3497576219972176*xippone - 0.5554971567967518*xipppone,2) + 0.17862041985779245*(0.00521861179270291 + 0.01043722358540582*etaone + 0.0013409906240915892*(-21.43471968802391 - 23.554564814934146*xipone)*(-9.644165638005003 - 94.30101983014437*chi2one + 94.30101983014437*chi3pone - 19.288331276010002*etaone - 21.14774839788835*etapone - 10.573874198944175*xipone - 21.14774839788835*etaone*xipone) + 1.0640496205808874*(-1.881506838321464 - 7.759898406814436*xipone - 3.3447757526006585*xippone)*(-0.8602321292403817 - 31.12235419766553*chi2one - 26.781710216390817*chi2pone + 31.12235419766553*chi3pone + 13.390855108195408*chi3ppone - 1.7204642584807623*etaone - 6.97943370397999*etapone - 3.0030050064227494*etappone - 3.489716851989995*xipone - 26.781710216390817*chi2one*xipone + 26.781710216390817*chi3pone*xipone - 6.97943370397999*etaone*xipone - 6.006010012845499*etapone*xipone - 1.5015025032113747*xippone - 3.0030050064227494*etaone*xippone) + 274.3277094535668*(-0.12317478944736678 - 1.8519260853437824*xipone - 2.3497576219972176*xippone - 0.5554971567967518*xipppone)*(-0.0603840601775833 - 7.490464911782916*chi2one - 18.84222303076416*chi2pone - 6.671821213032981*chi2ppone + 6.864981673061074*chi3pone + 6.08520090886559*chi3ppone - 0.12076812035516646*etaone - 1.5395263533682608*etapone - 1.364654359020563*etappone - 0.8398979545657034*xipone - 18.84222303076416*chi2one*xipone - 13.343642426065962*chi2pone*xipone + 18.84222303076416*chi3pone*xipone + 6.671821213032981*chi3ppone*xipone - 1.679795909131406*etaone*xipone - 4.225517312848003*etapone*xipone - 1.496208594806877*etappone*xipone - 1.0563793282120009*xippone - 6.671821213032981*chi2one*xippone + 6.671821213032981*chi3pone*xippone - 2.1127586564240013*etaone*xippone - 1.496208594806877*etapone*xippone - 0.2493680991344795*xipppone - 0.498736198268959*etaone*xipppone)) + 0.031905254390174054*(-0.007388820695184471 + 0.021805698799544394*etaone + 0.004685371606116969*pow(etaone,2) + 0.011635291022249953*l2one + 0.00521861179270291*l5one - 0.01043722358540582*l6one + 0.0006704953120457946*(pow(-9.644165638005003 - 94.30101983014437*chi2one + 94.30101983014437*chi3pone - 19.288331276010002*etaone - 21.14774839788835*etapone - 10.573874198944175*xipone - 21.14774839788835*etaone*xipone,2) + 2*(-21.43471968802391 - 23.554564814934146*xipone)*(15.81946289443559 + 154.68331218116623*chi2one - 464.0499365434987*chi3pone - 31.63892578887118*etaone - 34.688954300297446*etapone - 21.50239916712641*l2one - 23.575254957536092*l2pone - 23.575254957536092*l3one - 9.644165638005001*l5one - 10.573874198944175*l5pone + 29.862205474954177*l6one + 21.14774839788835*l6pone + 17.344477150148723*xipone - 34.688954300297446*etaone*xipone - 23.575254957536092*l2one*xipone - 10.573874198944175*l5one*xipone + 21.14774839788835*l6one*xipone)) + 0.5320248102904437*(pow(-0.8602321292403817 - 31.12235419766553*chi2one - 26.781710216390817*chi2pone + 31.12235419766553*chi3pone + 13.390855108195408*chi3ppone - 1.7204642584807623*etaone - 6.97943370397999*etapone - 3.0030050064227494*etappone - 3.489716851989995*xipone - 26.781710216390817*chi2one*xipone + 26.781710216390817*chi3pone*xipone - 6.97943370397999*etaone*xipone - 6.006010012845499*etapone*xipone - 1.5015025032113747*xippone - 3.0030050064227494*etaone*xippone,2) + 2*(-1.881506838321464 - 7.759898406814436*xipone - 3.3447757526006585*xippone)*(1.4110510706589834 + 51.05044292035792*chi2one + 43.93042248757584*chi2pone - 153.15132876107376*chi3pone - 65.89563373136377*chi3ppone - 2.8221021413179668*etaone - 11.44846497339134*etapone - 4.925872082049402*etappone - 1.917952813504359*l2one - 6.106731660891956*l2pone - 7.7805885494163824*l3one - 6.695427554097704*l3pone - 0.8602321292403814*l5one - 2.738965600384307*l5pone + 5.210181110470757*l6one + 8.480936207191363*l6pone + 5.72423248669567*xipone + 43.93042248757584*chi2one*xipone - 131.79126746272755*chi3pone*xipone - 11.44846497339134*etaone*xipone - 9.851744164098804*etapone*xipone - 7.7805885494163824*l2one*xipone - 6.695427554097704*l2pone*xipone - 6.695427554097704*l3one*xipone - 3.489716851989995*l5one*xipone - 3.0030050064227494*l5pone*xipone + 9.98243871040274*l6one*xipone + 6.006010012845499*l6pone*xipone + 2.462936041024701*xippone - 4.925872082049402*etaone*xippone - 3.347713777048852*l2one*xippone - 1.5015025032113747*l5one*xippone + 3.0030050064227494*l6one*xippone)) + 137.1638547267834*(pow(-0.0603840601775833 - 7.490464911782916*chi2one - 18.84222303076416*chi2pone - 6.671821213032981*chi2ppone + 6.864981673061074*chi3pone + 6.08520090886559*chi3ppone - 0.12076812035516646*etaone - 1.5395263533682608*etapone - 1.364654359020563*etappone - 0.8398979545657034*xipone - 18.84222303076416*chi2one*xipone - 13.343642426065962*chi2pone*xipone + 18.84222303076416*chi3pone*xipone + 6.671821213032981*chi3ppone*xipone - 1.679795909131406*etaone*xipone - 4.225517312848003*etapone*xipone - 1.496208594806877*etappone*xipone - 1.0563793282120009*xippone - 6.671821213032981*chi2one*xippone + 6.671821213032981*chi3pone*xippone - 2.1127586564240013*etaone*xippone - 1.496208594806877*etapone*xippone - 0.2493680991344795*xipppone - 0.498736198268959*etaone*xipppone,2) + 2*(-0.12317478944736678 - 1.8519260853437824*xipone - 2.3497576219972176*xippone - 0.5554971567967518*xipppone)*(0.09904883794511916 + 12.286716775898674*chi2one + 30.907168050829238*chi2pone + 10.943883802862238*chi2ppone - 33.78218300814102*chi3pone - 29.94492637195051*chi3ppone - 0.19809767589023833*etaone - 2.52530710652051*etapone - 2.2384620719477093*etappone - 0.13463084459619107*l2one - 0.9555953046570698*l2pone - 1.872616227945729*l3one - 3.8765781060619173*l3pone - 0.06038406017758326*l5one - 0.42859958692898975*l5pone + 0.9606660749208696*l6one + 2.5959056815802617*l6pone + 1.377696632978298*xipone + 30.907168050829238*chi2one*xipone + 21.887767605724477*chi2pone*xipone - 92.72150415248773*chi3pone*xipone - 32.831651408586715*chi3ppone*xipone - 2.755393265956596*etaone*xipone - 6.93117651121366*etapone*xipone - 2.454252367318241*etappone*xipone - 1.8726162279457288*l2one*xipone - 3.8765781060619173*l2pone*xipone - 4.71055575769104*l3one*xipone - 3.3359106065164905*l3pone*xipone - 0.839897954565703*l5one*xipone - 1.738706507722282*l5pone*xipone + 3.7925545655554074*l6one*xipone + 4.973621610251441*l6pone*xipone + 1.732794127803415*xippone + 10.943883802862238*chi2one*xippone - 32.831651408586715*chi3pone*xippone - 3.46558825560683*etaone*xippone - 2.454252367318241*etapone*xippone - 2.35527787884552*l2one*xippone - 1.6679553032582453*l2pone*xippone - 1.6679553032582453*l3one*xippone - 1.0563793282120006*l5one*xippone - 0.7481042974034385*l5pone*xippone + 2.86086295382744*l6one*xippone + 1.496208594806877*l6pone*xippone + 0.40904206121970677*xipppone - 0.8180841224394135*etaone*xipppone - 0.5559851010860818*l2one*xipppone - 0.2493680991344795*l5one*xipppone + 0.498736198268959*l6one*xipppone))),
                    0.005574498704589358 + 0.00009656888000882487*pow(-55.60711589320047 - 60.78190384206769*xipone,2) + 0.2998419192092904*pow(-2.4934873759082077 - 10.165097904025943*xipone - 4.3632160007943925*xippone,2) + 114.62343151228981*pow(-0.13702298405889787 - 2.004263010390771*xipone - 2.5259256692336876*xippone - 0.5950931032203195*xipppone,2) + 0.17862041985779245*(0.005361868489760207 - 0.010723736979520414*etaone + 0.00019313776001764974*(-55.60711589320047 - 60.78190384206769*xipone)*(-26.800733416390276 + 243.21037593867857*chi2one - 729.6311278160358*chi3pone + 53.60146683278055*etaone + 58.46347666923087*etapone - 29.231738334615436*xipone + 58.46347666923087*etaone*xipone) + 0.5996838384185808*(-2.4934873759082077 - 10.165097904025943*xipone - 4.3632160007943925*xippone)*(-1.2206267979399612 + 40.743152186511566*chi2one + 34.91760990613822*chi2pone - 122.22945655953465*chi3pone - 52.37641485920732*chi3ppone + 2.4412535958799224*etaone + 9.793933824137584*etapone + 4.196788200778742*etappone - 4.896966912068792*xipone + 34.91760990613822*chi2one*xipone - 104.75282971841465*chi3pone*xipone + 9.793933824137584*etaone*xipone + 8.393576401557484*etapone*xipone - 2.098394100389371*xippone + 4.196788200778742*etaone*xippone) + 229.24686302457962*(-0.13702298405889787 - 2.004263010390771*xipone - 2.5259256692336876*xippone - 0.5950931032203195*xipppone)*(-0.07171979078320066 + 8.099812611970869*chi2one + 20.242483576317678*chi2pone + 7.143548072899842*chi2ppone - 22.290314940409523*chi3pone - 19.64840325512676*chi3ppone + 0.14343958156640133*etaone + 1.7860659417987619*etapone + 1.5743763135930409*etappone - 0.973525911132379*xipone + 20.242483576317678*chi2one*xipone + 14.287096145799683*chi2pone*xipone - 60.727450728953045*chi3pone*xipone - 21.43064421869953*chi3ppone*xipone + 1.947051822264758*etaone*xipone + 4.865935352156702*etapone*xipone + 1.7171827249706206*etappone*xipone - 1.2164838380391756*xippone + 7.143548072899842*chi2one*xippone - 21.43064421869953*chi3pone*xippone + 2.432967676078351*etaone*xippone + 1.7171827249706206*etapone*xippone - 0.2861971208284368*xipppone + 0.5723942416568736*etaone*xipppone)) + 0.031905254390174054*(-0.007505812429326104 - 0.022747647923241264*etaone + 0.005157348709726039*pow(etaone,2) + 0.011152792524693096*l1one - 0.005361868489760207*l4one + 0.00009656888000882487*(pow(-26.800733416390276 + 243.21037593867857*chi2one - 729.6311278160358*chi3pone + 53.60146683278055*etaone + 58.46347666923087*etapone - 29.231738334615436*xipone + 58.46347666923087*etaone*xipone,2) + 2*(-55.60711589320047 - 60.78190384206769*xipone)*(43.96162651473802 - 398.94145975074144*chi2one + 398.94145975074144*chi3pone + 87.92325302947604*etaone + 95.89847733472939*etapone - 55.74605566575123*l1one - 60.80259398466964*l1pone + 26.800733416390276*l4one + 29.231738334615436*l4pone + 47.949238667364696*xipone + 95.89847733472939*etaone*xipone - 60.80259398466964*l1one*xipone + 29.231738334615436*l4one*xipone)) + 0.2998419192092904*(pow(-1.2206267979399612 + 40.743152186511566*chi2one + 34.91760990613822*chi2pone - 122.22945655953465*chi3pone - 52.37641485920732*chi3ppone + 2.4412535958799224*etaone + 9.793933824137584*etapone + 4.196788200778742*etappone - 4.896966912068792*xipone + 34.91760990613822*chi2one*xipone - 104.75282971841465*chi3pone*xipone + 9.793933824137584*etaone*xipone + 8.393576401557484*etapone*xipone - 2.098394100389371*xippone + 4.196788200778742*etaone*xippone,2) + 2*(-2.4934873759082077 - 10.165097904025943*xipone - 4.3632160007943925*xippone)*(2.0022116026160823 - 66.83157552551025*chi2one - 57.275855165299234*chi2pone + 66.83157552551025*chi3pone + 28.637927582649617*chi3ppone + 4.004423205232165*etaone + 16.065129793182617*etapone + 6.884051737601438*etappone - 2.5389278855874524*l1one - 8.003437427494251*l1pone + 1.2206267979399612*l4one + 3.8477698618741063*l4pone + 8.032564896591309*xipone - 57.275855165299234*chi2one*xipone + 57.275855165299234*chi3pone*xipone + 16.065129793182617*etaone*xipone + 13.768103475202876*etapone*xipone - 10.18578804662789*l1one*xipone - 8.729402476534554*l1pone*xipone + 4.896966912068792*l4one*xipone + 4.196788200778742*l4pone*xipone + 3.442025868800719*xippone + 6.884051737601438*etaone*xippone - 4.364701238267277*l1one*xippone + 2.098394100389371*l4one*xippone)) + 114.62343151228981*(pow(-0.07171979078320066 + 8.099812611970869*chi2one + 20.242483576317678*chi2pone + 7.143548072899842*chi2ppone - 22.290314940409523*chi3pone - 19.64840325512676*chi3ppone + 0.14343958156640133*etaone + 1.7860659417987619*etapone + 1.5743763135930409*etappone - 0.973525911132379*xipone + 20.242483576317678*chi2one*xipone + 14.287096145799683*chi2pone*xipone - 60.727450728953045*chi3pone*xipone - 21.43064421869953*chi3ppone*xipone + 1.947051822264758*etaone*xipone + 4.865935352156702*etapone*xipone + 1.7171827249706206*etappone*xipone - 1.2164838380391756*xippone + 7.143548072899842*chi2one*xippone - 21.43064421869953*chi3pone*xippone + 2.432967676078351*etaone*xippone + 1.7171827249706206*etapone*xippone - 0.2861971208284368*xipppone + 0.5723942416568736*etaone*xipppone,2) + 2*(-0.13702298405889787 - 2.004263010390771*xipone - 2.5259256692336876*xippone - 0.5950931032203195*xipppone)*(0.11764299906054125 - 13.286238527676367*chi2one - 33.20403546003606*chi2pone - 11.717664121043926*chi2ppone + 12.187707516328498*chi3pone + 10.74318566949607*chi3ppone + 0.23528599812108253*etaone + 2.9297095211593067*etapone + 2.5824719949454775*etappone - 0.14917858355664468*l1one - 1.0388427760705121*l1pone + 0.07171979078320066*l4one + 0.49943889250112067*l4pone + 1.5968884822177374*xipone - 33.204035460036074*chi2one*xipone - 23.435328242087852*chi2pone*xipone + 33.20403546003606*chi3pone*xipone + 11.717664121043926*chi3ppone*xipone + 3.193776964435475*etaone*xipone + 7.981663384836756*etapone*xipone + 2.8167193949458005*etappone*xipone - 2.024953152992717*l1one*xipone - 4.1676773849669395*l1pone*xipone + 0.973525911132379*l4one*xipone + 2.0036719948356962*l4pone*xipone + 1.995415846209189*xippone - 11.717664121043926*chi2one*xippone + 11.717664121043926*chi3pone*xippone + 3.990831692418378*etaone*xippone + 2.8167193949458005*etapone*xippone - 2.5303104470397098*l1one*xippone - 1.7858870182249604*l1pone*xippone + 1.2164838380391756*l4one*xippone + 0.8585913624853103*l4pone*xippone + 0.4694532324909668*xipppone - 2.4079492442951504e-16*chi2one*xipppone + 0.9389064649819336*etaone*xipppone - 0.5952956727416536*l1one*xipppone + 0.2861971208284368*l4one*xipppone))),
                    0.011230070923090299 + 0.43722981259908034*pow(-1.1637678621758552 - 1.2821131458357442*xipone,2) + 59.96258889104367*pow(-0.24430077931235913 - 1.013970320861633*xipone - 0.4379263124342502*xippone,2) + 0.17862041985779245*(0.010314505273247983 + 0.8744596251981607*(-1.1637678621758552 - 1.2821131458357442*xipone)*(-0.5373068166991254 + 5.211213153750762*chi3pone - 0.588792488230531*xipone) + 119.92517778208735*(-0.24430077931235913 - 1.013970320861633*xipone - 0.4379263124342502*xippone)*(-0.11539798429490701 + 4.138641853854318*chi3pone + 1.7799734501929063*chi3ppone - 0.4676072851236219*xipone + 3.5599469003858126*chi3pone*xipone - 0.20111151967925986*xippone) + 4583.324206867149*(-0.04088766471461789 - 0.6264656863841432*xipone - 0.7977458109481412*xippone - 0.18890117904069947*xipppone)*(-0.021080009295892717 + 2.3726800407359883*chi3pone + 2.1019796025996245*chi3ppone - 0.2924773787442246*xipone + 6.507354140755201*chi3pone*xipone + 2.3033949355559518*chi3ppone*xipone - 0.3676189327982871*xippone + 2.3033949355559518*chi3pone*xippone - 0.08675021826139492*xipppone)) + 2291.6621034335744*pow(-0.04088766471461789 - 0.6264656863841432*xipone - 0.7977458109481412*xippone - 0.18890117904069947*xipppone,2) + 0.031905254390174054*(-0.014550634616375608 + 0.022822593115919745*l2one - 0.010314505273247983*l5one + 0.43722981259908034*(pow(-0.5373068166991254 + 5.211213153750762*chi3pone - 0.588792488230531*xipone,2) + 2*(-1.1637678621758552 - 1.2821131458357442*xipone)*(0.8813520597575941 + 8.54802750337334*chi3pone - 1.1888825039179742*l2one - 1.3028032884376906*l2pone + 0.5373068166991254*l5one + 0.588792488230531*l5pone + 0.9658047434792989*xipone - 1.3028032884376906*l2one*xipone + 0.588792488230531*l5one*xipone)) + 59.96258889104367*(pow(-0.11539798429490701 + 4.138641853854318*chi3pone + 1.7799734501929063*chi3ppone - 0.4676072851236219*xipone + 3.5599469003858126*chi3pone*xipone - 0.20111151967925986*xippone,2) + 2*(-0.24430077931235913 - 1.013970320861633*xipone - 0.4379263124342502*xippone)*(0.18928896486929 + 6.788673452724926*chi3pone + 2.9197159200007277*chi3ppone - 0.2553376213584142*l2one - 0.8121637821894662*l2pone + 0.11539798429490701*l5one + 0.36705152528399193*l5pone + 0.7670229207833379*xipone + 5.839431840001455*chi3pone*xipone - 1.0346604634635794*l2one*xipone - 0.8899867250964532*l2pone*xipone + 0.4676072851236219*l5one*xipone + 0.4022230393585197*l5pone*xipone + 0.32988610343566505*xippone - 0.4449933625482266*l2one*xippone + 0.20111151967925986*l5one*xippone)) + 2291.6621034335744*(pow(-0.021080009295892717 + 2.3726800407359883*chi3pone + 2.1019796025996245*chi3ppone - 0.2924773787442246*xipone + 6.507354140755201*chi3pone*xipone + 2.3033949355559518*chi3ppone*xipone - 0.3676189327982871*xippone + 2.3033949355559518*chi3pone*xippone - 0.08675021826139492*xipppone,2) + 2*(-0.04088766471461789 - 0.6264656863841432*xipone - 0.7977458109481412*xippone - 0.18890117904069947*xipppone)*(0.03457784088201485 + 3.891941021510214*chi3pone + 3.4479072193811677*chi3ppone - 0.046643097491816915*l2one - 0.33042255985904395*l2pone + 0.021080009295892717*l5one + 0.14933207715510982*l5pone + 0.4797548294144765*xipone + 10.674106110844807*chi3pone*xipone + 3.778291672082472*chi3ppone*xipone - 0.6471558289860896*l2one*xipone - 1.3389141682443062*l2pone*xipone + 0.2924773787442246*l5one*xipone + 0.605112538204482*l5pone*xipone + 0.6030105957302409*xippone + 3.778291672082472*chi3pone*xippone - 0.8134192675944001*l2one*xippone - 0.5758487338889879*l2pone*xippone + 0.3676189327982871*l5one*xippone + 0.26025065478418474*l5pone*xippone + 0.1422976243234878*xipppone - 0.191949577962996*l2one*xipppone + 0.08675021826139492*l5one*xipppone))),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            static_assert(std::numeric_limits<double>::is_iec559, "Unexpected absence of IEC559");
            return (0.0 < result) && (result < 1.0) ? std::log(1.0) : std::log(1.0e-100);
        }
    };

    HQETUnitarityBounds::HQETUnitarityBounds(const Parameters & p, const Options & o) :
        PrivateImplementationPattern<HQETUnitarityBounds>(new Implementation<HQETUnitarityBounds>(p, o, *this))
    {
    }

    HQETUnitarityBounds::~HQETUnitarityBounds() = default;

    double
    HQETUnitarityBounds::bound_0p() const
    {
        return _imp->bound_0p();
    }

    double
    HQETUnitarityBounds::bound_0m() const
    {
        return _imp->bound_0m();
    }
}
